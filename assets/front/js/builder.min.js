!function(t){"use strict";window.matchMedia("(max-width: 576px)").matches;const e=window.matchMedia("(max-width: 768px)").matches,s=WCCON_BUILDER_FRONT.currency_format_symbol,o=WCCON_BUILDER_FRONT.price_position,i=WCCON_BUILDER_FRONT.decimals?WCCON_BUILDER_FRONT.decimals:2,n=WCCON_BUILDER_FRONT.decimal_separator?WCCON_BUILDER_FRONT.decimal_separator:".",c=WCCON_BUILDER_FRONT.thousand_separator;function a(t){let e=t.toFixed(i);switch(e=e.replace(".",n),c&&(e=function(t){const e=/(\d+)(\d{3})/;return String(t).replace(/^\d+/,(function(t){for(;e.test(t);)t=t.replace(e,"$1"+c+"$2");return t}))}(e)),o){case"left":e=`${s}${e}`;break;case"right":e=`${e}${s}`;break;case"left_space":e=`${s} ${e}`;break;case"right_space":e=`${e} ${s}`}return e}function r(t){return parseInt(t,10)<1||isNaN(parseInt(t,10))?0:parseInt(t,10)}function d(t){return t.map((t=>t.hasOwnProperty("components")?{...t,components:d(t.components)}:{...t,products:[]}))}function l(t,e,s,o,i=!1){return e.map((e=>{if(e.slug===t){if("add"===o){if(e.multiple){const t=e.products.filter((t=>parseInt(t.clone,10)!==parseInt(s.clone,10)));return{...e,products:[...t,s]}}return{...e,products:[s]}}return{...e,products:e.products.filter((t=>e.multiple?parseInt(t.clone,10)!==parseInt(s.clone,10):t.product_id!==s.product_id)).map(((t,e)=>({...t,clone:e})))}}if(e.hasOwnProperty("components")){let i=!1;return e.hasOwnProperty("multiple")&&e.multiple&&(i=!0),{...e,components:l(t,e.components,s,o,i)}}return e})).filter((t=>null!==t))}function p(t,e,s,o,i){return o.map((o=>o.slug===t?{...o,products:o.products.map((t=>t.product_id===e||t.variation_id===e?{...t,quantity:i}:t))}:o.hasOwnProperty("components")?{...o,components:p(t,e,s,o.components,i)}:o))}function h(s){const o=window.innerHeight,i=t(s),n=i.find(".wccon-saved-lists"),c=i.find(".wccon-modal-inner"),a=i.find(".wccon-modal__header"),r=i.find(".wccon-button-container"),d=(c.outerHeight(),a.outerHeight());let l=r.outerHeight();l||(l=50);let p=150;e&&(p=50);const h=o-d-l-p;n.height(h)}function u(t,e,s=[]){let o=s;for(const i of e){if(i.slug===t){if(i.hasOwnProperty("components"))for(const t of i.components)o=[...o,...t.products];else o=[...s,...i.products];break}if(i.hasOwnProperty("components")){if(o.length)break;o=u(t,i.components,o)}}return o}function m(t,e=[]){for(const s of t){if(s.hasOwnProperty("components"))for(const t of s.components)t.hasOwnProperty("products")&&t.products.length&&(e=[...e,...t.products]),t.hasOwnProperty("components")&&(e=m(t.components,e));s.hasOwnProperty("products")&&s.products.length&&(e=[...e,...s.products])}return e}function g(e,s,o=!0,i=!1){const n=[],c=t(document.body).find(`${e}`);if(!c.length)return;const a=t("<div />",{class:"wccon-saved-lists wccon-skeleton-saved-lists"});for(let e=0;e<s;e++){const e=t("<div/>",{class:"wccon-skeleton-item"}),s=t("<div/>",{class:"wccon-skeleton-head"}),o=t("<div/>",{class:"wccon-skeleton-body"}),i=t("<div/>",{class:"wccon-skeleton-body__left"}),c=t("<div/>",{class:"wccon-skeleton-body__right"}),a=t("<ul/>",{class:"wccon-skeleton-list"}),r=t("<div/>",{class:"wccon-skeleton-footer"}),d=t("<div/>",{class:"wccon-skeleton-footer__left"}),l=t("<div/>",{class:"wccon-skeleton-footer__right"});r.append(d),r.append(l);for(let e=0;e<6;e++){const e=t("<li/>",{class:"wccon-skeleton-list__item"});a.append(e)}c.append(a),o.append(i),o.append(c),e.append(s),e.append(o),e.append(r),n.push(e)}o&&(i?c.append(n):(a.append(n),c.append(a))),o||c.html(n.map((t=>t.length?t.get(0).outerHTML:null)).filter((t=>null!==t)).join(""))}function _(e,s="on"){const o=e.find('a[href]:not([disabled]), button:not([disabled]), textarea:not([disabled]), input[type="text"]:not([disabled]), input[type="radio"]:not([disabled]), input[type="checkbox"]:not([disabled]), select:not([disabled])'),i=o.first(),n=o.last(),c=function(s){if(!("Tab"===s.key||9===s.keyCode))return;t("html, body").animate({scrollTop:e.offset().top},0);const o=t(s.target);s.shiftKey?(o.is(e)||o.is(i))&&(s.preventDefault(),n.focus()):o.is(n)&&(s.preventDefault(),i.focus())};"on"===s?(e.attr("tabindex","-1").focus(),e.on("keydown.wccon",c)):e.off("keydown.wccon")}class w{constructor(e){this.searchTimeOut,this.productRequest=null,this.compatibilityRequest=null,this.builderWrapper=t(e),this.builderId=this.builderWrapper.attr("data-wccon-builder"),this.builderWrapperData=JSON.parse(this.builderWrapper.attr("data-wccon-scheme")),this.ajaxUrl=WCCON_BUILDER_FRONT.ajax_url,this.compatiblityEnabled=WCCON_BUILDER_FRONT.compatibility_enabled,this.successMessage=WCCON_BUILDER_FRONT.i18n_success_message,this.copiedMessage=WCCON_BUILDER_FRONT.i18n_copied_message,this.errorMessage=WCCON_BUILDER_FRONT.i18n_error_message,this.addedToCartMessage=WCCON_BUILDER_FRONT.i18n_added_to_cart,this.saveToStorage=WCCON_BUILDER_FRONT.local_storage,this.soldIndividually=WCCON_BUILDER_FRONT.sold_individually,this.nonce=WCCON_BUILDER_FRONT.nonce,this.currentLang=function(){if(WCCON_BUILDER_FRONT.languages&&Array.isArray(WCCON_BUILDER_FRONT.languages)){const t=WCCON_BUILDER_FRONT.languages.find((t=>1==t.active||t.active));return t?t.code:null}return null}();const s=new URLSearchParams(window.location.search);this.savedListQuery=s.get("wccon-list"),this.savedList=localStorage.getItem("wccon-list"),this.maybeClearLists.bind(this)(),this.productScheme=this.rebuildList.bind(this)(),this.componentContainer=t(e).find(".wccon-component").first(),this.componentHead=this.builderWrapper.find(".wccon-component-inner"),this.addCartButton=this.builderWrapper.find(".wccon-add-to-cart"),this.multipleButtons=this.builderWrapper.find(".wccon-component-product__multiple"),this.openedContent=!0,this.totalsContainer=this.builderWrapper.find(".wccon-bottom-block"),this.saveListButton=this.builderWrapper.find(".wccon-save-list-button"),this.clearListButton=this.builderWrapper.find(".wccon-clear-list-button"),this.shareListButton=this.builderWrapper.find(".wccon-share-list-button"),this.shareListButtonClose=this.builderWrapper.find(".wccon-share-close"),this.openMyLists=this.builderWrapper.find(".wccon-open-user-lists"),this.openUsersLists=this.builderWrapper.find(".wccon-open-lists"),this.closeModalButton=t(document.body).find(".wccon-modal__close"),this.dataStore=this.productScheme.groups,this.incompatibleData=[],this.totalPrice=0,this.totalPriceField=this.builderWrapper.find(".wccon-total-price"),this.timeOutAnimationLoading=wp.hooks.applyFilters("wccon-timeout-loading",800),this.loadListTimeOut=null,this.isMobile=window.matchMedia("(max-width: 576px)").matches,this.isTablet=window.matchMedia("(max-width: 768px)").matches,this.isDesktop=window.matchMedia("(min-width: 998px)").matches,this.toolTips=this.builderWrapper.find(".wccon-tooltip"),this.tippyInstances=[],this.initTooltips(),this.toggleExtraContainer=this.builderWrapper.find(".wccon-component-extra"),this.isListExists()&&this.runCompatibilitySaved(),this.builderWrapper.on("wccon-products-loaded",((t,e)=>{this.initProperties("init"),this.initEvents(),this.initPriceWidget("init")})).on("wccon-filter-end",((t,e)=>{this.initProperties("ajax"),this.initEvents(),this.initPriceWidget("ajax")}));const o=this;this.builderWrapper.on("click",".wccon-refresh-button",this.editProduct.bind(this)).on("click",".wccon-close-button",this.removeProduct.bind(this)).on("click",".wccon-collapse-button",this.collapseProducts.bind(this)).on("click",".wccon-component-product__multiple",this.addMultiple.bind(this)).on("click",".wccon-dropdown-select",this.handleSelect.bind(this)).on("click",".wccon-dropdown-select li a",this.handleSorting.bind(this)).on("click",".product-attribute-group__nice-select",this.handleVariationSelectOpen.bind(this)).on("click",".product-attribute-group__nice-select li",this.handleVariationSelect.bind(this)).on("click",".product-attribute-group__color li, .product-attribute-group__button li",this.handleVariationColor.bind(this)).on("click",".wccon-pagination-item",this.handlePagination.bind(this)).on("click",".wccon-product-title .desc-toggler",this.handleExpandDescription.bind(this)).on("click",".product-item__add",this.chooseProduct.bind(this)).on("wccon-load-list-start",this.loadListStart.bind(this)).on("wccon-load-list-end",this.loadListEnd.bind(this)).on("click",".wccon-reset_variations",this.resetVariations.bind(this)).on("click",".wccon-widget-head",this.toggleWidget).on("click",".widget-expander-show",this.expandWidget).on("click",".widget-expander-hide",this.collapseWidget).on("click",".wccon-clear-all",this.clearFilters.bind(this)).on("click",".wccon-filters-btn",this.openFilters).on("click",".wccon-close-filters",this.closeFilters).on("click",".wccon-component-inner",this.maybeGetProducts.bind(this)).on("click",".share-link",this.copyLink.bind(this)).on("click",".plus, .minus",(function(e){e.preventDefault(),e.stopPropagation();let s=1;const i=t(this).siblings("input"),n=parseFloat(i.val()),c=parseFloat(i.attr("max")),r=parseFloat(i.attr("min")),d=i.attr("step");n&&""!==n&&"NaN"!==n||(n=0),""!==c&&"NaN"!==c||(c=""),""!==r&&"NaN"!==r||(r=0),"any"!==d&&""!==d&&void 0!==d&&"NaN"!==parseFloat(d)||(d=1),t(this).is(".plus")?c&&n>=c?(i.val(c),s=c):(i.val(n+parseFloat(d)),s=n+parseFloat(d)):r&&n<=r?(i.val(r),s=r):n>0&&(i.val(n-parseFloat(d)),s=n-parseFloat(d)),i.trigger("change");const l=t(this).closest(".wccon-component-product-item").find(".wccon-component-product").attr("data-product-id"),h=t(this).closest(".wccon-component-product-item").find(".wccon-component-product").attr("data-variation-id"),u=t(this).closest(".wccon-component").attr("data-component-slug");o.dataStore=p(u,l,h,o.productScheme.groups,s),o.productScheme={...o.productScheme,groups:o.dataStore},o.maybeSaveToStorage(),o.totalPrice=o.calculateTotals(),o.totalPriceField.html(a(o.totalPrice))})),this.addCartButton.on("click",this.buyProduct.bind(this)),this.saveListButton.on("click",this.saveList.bind(this)),this.clearListButton.on("click",this.clearList.bind(this)),this.shareListButton.on("click",this.shareList),this.shareListButtonClose.on("click",this.shareList),this.openUsersLists.on("click",this.openUsersListsHandler),this.openMyLists.on("click",this.openMyListsHandler),this.closeModalButton.on("click",this.closeModal),this.toggleExtraContainer.on("click",this.toggleExtraHandler.bind(this)),this.isListExists()||this.maybeLoadList.bind(this)(),t(document.body).on("wccon_builder_loaded",(function(e,s){s.isTablet&&t("#wccon-share-modal .wccon-modal__body").append(t(".wccon-share-box").addClass("active"));m(s.dataStore).length||s.addCartButton.attr("disabled",!0),s.isAccountPage()&&s.builderWrapper.width()<900&&s.isDesktop&&s.builderWrapper.addClass("minimal")})),this.builderWrapper.on("wccon-product-chosen",((t,e,s,o)=>{m(o).length?this.addCartButton.attr("disabled",!1):this.addCartButton.attr("disabled",!0)})),this.builderWrapper.on("wccon-product-removed",((t,e,s,o)=>{m(o).length?this.addCartButton.attr("disabled",!1):this.addCartButton.attr("disabled",!0)})),this.builderWrapper.on("wccon-builder-cleared",((t,e)=>{this.addCartButton.attr("disabled",!0)})),t(document.body).trigger("wccon_builder_loaded",this)}initProperties(t){this.componentHead=this.builderWrapper.find(".wccon-component-inner"),this.multipleButtons=this.builderWrapper.find(".wccon-component-product__multiple"),this.form=this.builderWrapper.find("#wccon-filter-form"),this.searchField=this.builderWrapper.find("#wccon-product-search"),this.paginationLinks=this.builderWrapper.find(".wccon-pagination-item"),this.query=new URLSearchParams,"init"===t&&(this.activeFilters={tax_query:[],meta_query:[],search:"",prices:[],pagination:1,stock:"all",orderby:"menu_order"},this.maxPrice=0,this.minPrice=0,this.manualChangedPrice=!1)}initEvents(){this.form.on("change",this.handleForm.bind(this)),this.searchField.on("keyup",this.search.bind(this));const e=this;t("select[name^=attribute_]",this.builderWrapper).on("change",(function(s){const o=t(this).closest(".wccon-product-item");e.chooseVariation(o)}));const s=this.builderWrapper.find(`.wccon-component.opened[data-component-slug=${this.componentSlug}]`);s.find(".wccon-product-item").each(((e,s)=>{t(s).attr("data-product_variations")&&this.chooseVariation(t(s))})),s.find(".product-item__desc").each(((e,s)=>{t(s).get(0).scrollHeight>43&&(t(s).siblings(".wccon-product-title").append('<span class="desc-toggler"><svg><use xlink:href="#icon-ch-dw"></use></svg></span>'),t(s).addClass("desc-over"))}))}initPriceWidget(t){if(this.priceFilter=this.builderWrapper.find("#wccon-slider").get(0),this.priceWidget=this.builderWrapper.find(".wccon-slider-wrapper"),this.priceFilter){const e=parseFloat(this.priceFilter.dataset.minPrice),s=parseFloat(this.priceFilter.dataset.maxPrice),o=parseFloat(this.priceFilter.dataset.startPrice),i=parseFloat(this.priceFilter.dataset.endPrice);"init"===t&&(this.maxPrice=s,this.minPrice=e,this.manualChangedPrice=!1);const n=this.priceWidget.find(".inps");let c=s;if(c=this.manualChangedPrice?i>s?s:i:s>i?i:s,noUiSlider.create(this.priceFilter,{start:[o,c],connect:!0,step:1,format:{to:t=>parseFloat(t).toFixed(0),from:t=>parseFloat(t).toFixed(0)},range:{min:0,max:this.maxPrice},tooltips:!n.length}),n.length>0){const t=n.find(".inp-min"),e=n.find(".inp-max");this.priceWidget.find(".wccon-price-filter-button").on("click",(t=>{t.preventDefault(),this.manualChangedPrice=!0,this.buildQueryString(),this.sendRequest()})),t.on("change",(t=>{this.priceFilter.noUiSlider.set([parseInt(t.target.value,10),null])})),e.on("change",(t=>{this.priceFilter.noUiSlider.set([null,parseInt(t.target.value,10)])})),this.priceFilter.noUiSlider.on("update",((s,o)=>{const i=s[o];this.activeFilters.prices=s,o?e.val(i):t.val(i)}))}this.priceFilter.noUiSlider.on("end",(t=>{this.activeFilters.prices=t,this.manualChangedPrice=!0,this.buildQueryString(),this.sendRequest()}))}}initTooltips(){this.isDesktop&&this.toolTips.each(((e,s)=>{tippy(t(s).get(0),{content:t(s).data("tippy"),popperOptions:{modifiers:[{name:"eventListeners",enabled:!1}]}})}))}rebuildList(){if(this.isListExists())return this.builderWrapperData;if(!this.savedList||this.savedList&&!this.saveToStorage)return this.builderWrapperData;if(!WCCON_BUILDER_FRONT.nonce2)return this.builderWrapperData;JSON.parse(this.savedList);return this.builderWrapperData}loadListStart(e,s,o){this.loadListTimeOut=setTimeout((()=>{t(".wccon-component-wrapper",this.builderWrapper).addClass("wccon-loading")}),this.timeOutAnimationLoading),t.blockUI.defaults.overlayCSS.cursor="default",this.builderWrapper.block({message:null,overlayCSS:{background:"transparent"},blockMsgClass:"wccon-block-message"}),t(".blockUI.blockOverlay").addClass("wccon-block-overlay")}loadListEnd(e,s,o,i){this.builderWrapper.unblock(),clearTimeout(this.loadListTimeOut),this.loadListTimeOut=null,t(".wccon-component-wrapper",this.builderWrapper).removeClass("wccon-loading"),t(".blockUI.blockOverlay").removeClass("wccon-block-overlay")}maybeClearLists(){if(this.savedList&&this.saveToStorage&&WCCON_BUILDER_FRONT.nonce2){const t=JSON.parse(this.savedList);if(!Array.isArray(t))return localStorage.removeItem("wccon-list"),void(this.savedList=null);let e=Array.isArray(WCCON_BUILDER_FRONT.saved_config_ids)?WCCON_BUILDER_FRONT.saved_config_ids:[];const s=t.filter((t=>-1!==e.indexOf(parseInt(t.id,10))));localStorage.setItem("wccon-list",JSON.stringify(s))}}maybeLoadList(){}search(t){16!==t.keyCode&&9!==t.keyCode&&(this.searchTimeOut&&clearTimeout(this.searchTimeOut),this.searchTimeOut=setTimeout((()=>{this.activeFilters.search=t.target.value,this.buildQueryString(),this.sendRequest(t)}),500))}handlePagination(t){t.preventDefault();let e=t.target.attributes["data-link"].nodeValue;this.activeFilters.pagination=e,this.buildQueryString(!0),this.sendRequest()}handleSelect(e){const s=t(e.currentTarget),o=s.find("ul"),i=s.find("svg");o.toggleClass("active"),i.toggleClass("active")}handleSorting(e){e.preventDefault();const s=t(e.currentTarget),o=s.closest(".wccon-dropdown-select").attr("data-type");this.activeFilters[o]=e.target.hash.slice(1),s.closest(".wccon-dropdown-select").find(".wccon-dropdown-inner span").text(s.text()),this.buildQueryString(),this.sendRequest()}handleVariationSelectOpen(e){const s=t(e.currentTarget),o=s.find("ul"),i=s.find("svg");o.toggleClass("active"),i.toggleClass("active")}handleVariationSelect(e){const s=t(e.currentTarget),o=s.closest("li").attr("data-value");if(s.closest("li").hasClass("disabled"))return;const i=s.closest(".product-attribute-group").find("select");i.length&&(s.closest(".product-attribute-group").find(".product-attribute-selected span").text(s.text()),s.closest(".product-attribute-group").find("li").attr("aria-selected","false"),s.closest("li").attr("aria-selected","true"),i.val(o),i.trigger("change"))}handleVariationColor(e){const s=t(e.currentTarget),o=s.closest("li").attr("data-value");if(s.closest("li").hasClass("disabled"))return;const i=s.closest(".product-attribute-group").find("select");i.length&&(s.closest(".product-attribute-group").find("li").attr("aria-checked","false"),s.closest("li").attr("aria-checked","true"),i.val(o),i.trigger("change"))}manageDropdown(e){e.preventDefault();let s=e.target.attributes["data-option"].nodeValue;t("option:selected",this.periodRange).removeAttr("selected"),this.periodRange.find("option").eq(s-1).attr("selected","selected"),t(".dropdown .dropdown-toggle").html(this.periodRange.find("option").eq(s-1).html()),this.periodRange.trigger("change")}handleForm(t){-1===["min_price","max_price"].indexOf(t.target.name)&&(this.buildQueryString(),this.sendRequest())}buildQueryString(t=!1,e={}){let s=this.form.serializeArray(),o=[],i=[];s.forEach((t=>{if(/^wccon_tax_filter/.test(t.name)){let e=t.name.replace("wccon_tax_filter[","").slice(0,-1);o.find((t=>t.tax_name===e))?o=o.map((s=>s.tax_name===e?{...s,tax_value:[...s.tax_value,t.value]}:s)):o.push({tax_name:e,tax_value:[t.value]})}if(/^wccon_meta_filter/.test(t.name)){let e=t.name.replace("wccon_meta_filter[","").slice(0,-1);i.find((t=>t.meta_key===e))?i=i.map((s=>s.meta_key===e?{...s,meta_value:[...s.meta_value,t.value]}:s)):i.push({meta_key:e,meta_value:[t.value]})}})),this.activeFilters={tax_query:o,meta_query:i,prices:this.activeFilters.prices,pagination:t?this.activeFilters.pagination:1,orderby:this.activeFilters.orderby,stock:this.activeFilters.stock,search:this.searchField.val()};for(let t in this.activeFilters)this.query.delete(t),"tax_query"===t||"meta_query"===t?this.query.append(t,JSON.stringify(this.activeFilters[t])):"prices"===t?2===this.activeFilters.prices.length&&(this.minPrice===parseInt(this.activeFilters.prices[0],10)&&this.maxPrice===parseInt(this.activeFilters.prices[1],10)||!this.manualChangedPrice||this.query.append(t,this.activeFilters[t].join(","))):-1!==["pagination","orderby","stock","search"].indexOf(t)&&this.query.append(t,this.activeFilters[t])}sendRequest(){if(this.componentContainer=this.builderWrapper.find(`.wccon-component[data-component-slug=${this.componentSlug}]`),!this.componentContainer.length)return;const e=this.componentContainer.find(".wccon-products-body");!function(e,s){const o=[],i=t("<div />",{class:"wccon-skeleton-product-items"});for(let e=0;e<s;e++){const e=t("<div/>",{class:"wccon-skeleton-product-item"}),s=t("<div/>",{class:"wccon-skeleton-product-image"}),i=t("<div/>",{class:"wccon-skeleton-product-body"}),n=t("<div/>",{class:"wccon-skeleton-product-body__one"}),c=t("<div/>",{class:"wccon-skeleton-product-body__two"}),a=t("<div/>",{class:"wccon-skeleton-product-body__three"}),r=t("<div/>",{class:"wccon-skeleton-product-actions"});i.append(n),i.append(c),i.append(a),e.append(s),e.append(i),e.append(r),o.push(e)}i.append(o),e.find(".wccon-product-items").replaceWith(i)}(e,5);const s=u(this.componentSlug,this.productScheme.groups);this.query.append("selected_products",JSON.stringify(s)),t.ajax({url:this.ajaxUrl,type:"POST",data:`action=wccon_filter_builder&nonce=${this.nonce}&component_id=${this.componentId}&`+this.query.toString()}).then((s=>{t(e).find(".wccon-skeleton-product-items").remove(),s.success&&(this.componentContainer.find(".wccon-products-body").replaceWith(t(s.data.html).find(".wccon-products-body")),this.componentContainer.find("aside").replaceWith(t(s.data.html).find("aside")),this.form=t(document.body).find("#wccon-filter-form"),this.builderWrapper.trigger("wccon-filter-end",[this.componentSlug]))})).catch((t=>{console.log(t)}))}clearFilters(e){e.preventDefault(),this.activeFilters={tax_query:[],meta_query:[],search:"",prices:[],pagination:1,stock:"all",orderby:"menu_order"};for(const t in this.activeFilters)this.query.delete(t),"tax_query"===t||"meta_query"===t?this.query.append(t,JSON.stringify(this.activeFilters[t])):-1!==["pagination","orderby","stock","search"].indexOf(t)&&this.query.append(t,this.activeFilters[t]);const s=t(".wccon-dropdown-select[data-type=stock]"),o=t(".wccon-dropdown-select[data-type=orderby]");if(s.length){const e=s.find(".wccon-dropdown-inner span");s.find("li a").each(((s,o)=>{"#all"===t(o).attr("href")&&e.text(t(o).text())}))}if(o.length){const e=o.find(".wccon-dropdown-inner span");o.find("li a").each(((s,o)=>{"#menu_order"===t(o).attr("href")&&e.text(t(o).text())}))}this.searchField.val(""),this.sendRequest()}chooseProduct(e){e.preventDefault();const s=t(e.currentTarget),o=s.closest(".wccon-component"),i=o.hasClass("extra");o.addClass("selected"),i&&o.removeClass("exhide");const n=o.attr("data-component-slug"),c=o.attr("data-multiple"),r=o.find(".wccon-component-inner .wccon-component__body"),d=o.find(".wccon-component-inner .wccon-component__icon");o.find(".wccon-component__selected");d.hide();const p=s.closest(".wccon-product-item"),h=void 0!==p.attr("data-variation-id")&&this.maybeStringToNumber(p.attr("data-variation-id"),!1)>0?p.attr("data-variation-id"):p.attr("data-product-id"),m=p.attr("data-variation-id"),g=s.siblings(".product-item__price").find(".price").html(),w=p.find(".wccon-product-title").text(),f=s.closest(".wccon-product-item").find(".wccon-product-title").attr("href"),b=p.find(".wccon-product-sku span").text(),v=p.find(".product-item__image").html(),y=p.find(".stock"),C=p.attr("data-price"),k=p.data("product-info"),O=wp.template("wccon-filled-component"),x=[],R=p.find(".product-item__attributes");t(".product-attribute-group",R).each(((e,s)=>{let o=t(s).find("select").val(),i=t(s).find("select option:selected").text();const n=t(s).hasClass("product-attribute-group__color")?"color":"button";if("color"===n){o=t(s).find('li[aria-checked="true"]').find("div").css("background-color")}x.push({type:n,value:o,name:i})}));const W={title:w,href:f,image:v,sku:b===WCCON_BUILDER_FRONT.i18n_sku_na?"":b,stock_status:y.hasClass("outofstock")?"outofstock":"instock",price:g,quantity:1,product_id:h,multiple:c,variable:R.length,attributes:x};k&&this.soldIndividually&&(W.sold_individually=k.sold_individually??!1);const S=wp.hooks.applyFilters("wccon-choose-products-args",W,p,o);r.replaceWith(O(S));const L=s.closest(".wccon-component").attr("data-copy"),N={product_id:h,quantity:1,variation_id:m??"",variation:"",price:C,clone:L||0,component:n},T=l(n,this.productScheme.groups,N,"add");this.productScheme={...this.productScheme,groups:T},this.dataStore=T,this.maybeSaveToStorage(),this.totalPrice=this.calculateTotals(),this.totalPriceField.html(a(this.totalPrice));const F=o.find(".wccon-component-inner");t(F).removeClass("opened"),t(o).removeClass("opened"),t(document.body).removeClass("wccon-component-opened"),t(F).siblings(".wccon-product-list").remove(),_(o,"off");const I=o.parent(".wccon-component");if(I.length){const e=I.attr("data-component-slug");I.addClass("selected");const s=u(e,this.productScheme.groups).map((e=>{const s=t(`[data-component-slug=${e.component}]`),o=t(`.wccon-component-product[data-product-id=${e.product_id}]`);if(s.length&&o.length){const t=o.find(".wccon-component-product__title").text(),s=o.find(".wccon-component-product__image").html();return{...e,title:t,image:s}}return null})).filter((t=>null!==t)),o=wp.template("wccon-filled-subgroup"),i=I.find(".wccon-component-inner .wccon-component__body").first();i.siblings(".wccon-component__icon").hide(),i.replaceWith(o({products:s}))}this.totalsContainer.show(),this.builderWrapper.trigger("wccon-product-chosen",[n,h,this.dataStore,this.builderWrapper]),this.compatiblityEnabled&&WCCON_BUILDER_FRONT.nonce2?(null!==this.compatibilityRequest&&(this.compatibilityRequest.abort(),this.compatibilityRequest=null),this.compatibilityRequest=t.ajax({url:this.ajaxUrl,type:"POST",data:{action:"wccon_add_product",component_slug:n,data:JSON.stringify(this.dataStore),product:N,nonce:this.nonce}}),this.compatibilityRequest.then((t=>{this.runCompatibility(t.data.cd)})).catch((t=>{console.log(t)}))):this.runCompatibility({})}removeProduct(e){e.preventDefault();const s=t(e.currentTarget),o=s.closest(".wccon-component__body"),i=s.closest(".wccon-component"),n=i.hasClass("extra");i.removeClass("selected out-ofstock");s.closest(".wccon-component-inner").find(".wccon-component__icon").show();const c=s.closest(".wccon-component-product-item").find(".wccon-component-product").attr("data-product-id"),r=s.closest(".wccon-component").attr("data-copy"),d=s.closest(".wccon-component").attr("data-component-slug"),p=t(`[data-component-slug=${d}]`).length>1,h=i.parent(".wccon-component");if(r||!r&&p)i.remove();else{const t=wp.template("wccon-empty-component"),e={};s.closest(".wccon-component").find(".wccon-component__selected").find("svg").html('<use xlink:href="#icon-check"></use>'),o.replaceWith(t(e))}t(`[data-component-slug=${d}]`).each((function(e,s){t(this).attr("data-copy",(function(s,o){if(0!==e)return e;t(this).removeAttr("data-copy")}))}));const m=l(d,this.productScheme.groups,{product_id:c,clone:r||0},"remove");if(this.productScheme={...this.productScheme,groups:m},this.dataStore=m,this.maybeSaveToStorage(),this.totalPrice=this.calculateTotals(),this.totalPriceField.html(a(this.totalPrice)),h.length){const e=u(h.attr("data-component-slug"),this.productScheme.groups).map((e=>{const s=t(`[data-component-slug=${e.component}]`),o=t(`.wccon-component-product[data-product-id=${e.product_id}]`);if(s.length&&o.length){const t=o.find(".wccon-component-product__title").text(),s=o.find(".wccon-component-product__image").html();return{...e,title:t,image:s}}return null})).filter((t=>null!==t)),s=wp.template("wccon-filled-subgroup"),o=h.find(".wccon-component-inner .wccon-component__body").first();if(e.length)o.siblings(".wccon-component__icon").hide(),o.replaceWith(s({products:e}));else{h.removeClass("selected"),o.siblings(".wccon-component__icon").show();const t=wp.template("wccon-empty-subgroup");o.replaceWith(t({}))}}if(n){i.parents(".wccon-group").find(".wccon-component-extra").hasClass("opened")||i.addClass("exhide")}this.builderWrapper.trigger("wccon-product-removed",[d,c,this.dataStore,this.builderWrapper]),this.compatiblityEnabled&&WCCON_BUILDER_FRONT.nonce2?(null!==this.compatibilityRequest&&(this.compatibilityRequest.abort(),this.compatibilityRequest=null),this.compatibilityRequest=t.ajax({url:this.ajaxUrl,type:"POST",data:{action:"wccon_remove_product",component_slug:d,data:JSON.stringify(this.dataStore),nonce:this.nonce}}),this.compatibilityRequest.then((t=>{this.runCompatibility(t.data.cd)})).catch((t=>{console.log(t)}))):this.runCompatibility({})}runCompatibility(e){if(!this.compatiblityEnabled||!WCCON_BUILDER_FRONT.nonce2)return t(".wccon-component",this.builderWrapper).not(".wccon-component-has-children").each((function(){t(this).is(".selected")?t(this).find(".wccon-component__selected").addClass("compatible"):t(this).find(".wccon-component__selected").removeClass("compatible")})),void t(".wccon-component",this.builderWrapper).filter(".wccon-component-has-children").each((function(){t(this).find(".wccon-component.selected").length?t("> .wccon-component-inner",t(this)).find(".wccon-component__selected").addClass("compatible"):t("> .wccon-component-inner",t(this)).find(".wccon-component__selected").removeClass("compatible")}));t(".wccon-component__selected",this.builderWrapper).removeClass("incompatible compatible"),t(".product-top__required-item",this.builderWrapper).length&&t(".product-top__required-item",this.builderWrapper).removeClass("incompatible compatible"),t(".product-top__extra-item",this.builderWrapper).length&&t(".product-top__extra-item",this.builderWrapper).removeClass("incompatible compatible"),this.builderWrapper.trigger("wccon-run-compatibility",[this,e]),this.incompatibleData=[];const s=Object.values(e);for(let e of s){let s;s=parseInt(e.clone,10)>0?t(`[data-component-slug=${e.slug}][data-copy=${parseInt(e.clone,10)}]`,this.builderWrapper).first():t(`[data-component-slug=${e.slug}]`,this.builderWrapper).not("[data-copy]").first();const o=s.find(".wccon-component__selected");if(e.compatible)o.addClass("compatible"),o.find("svg").html('<use xlink:href="#icon-check"></use>'),t(`.product-top__required-item[data-image-slug="${e.slug}"]`).addClass("compatible"),t(`.product-top__extra-item[data-image-slug="${e.slug}"]`).addClass("compatible");else{this.incompatibleData=[...this.incompatibleData,{slug:e.slug,clone:e.clone,text:e.tippyText}],o.addClass("incompatible"),o.find("svg").html('<use xlink:href="#icon-uncheck"></use>'),t(`.product-top__required-item[data-image-slug="${e.slug}"]`).addClass("incompatible"),t(`.product-top__extra-item[data-image-slug="${e.slug}"]`).addClass("incompatible");let s=!0;this.isMobile&&(s=!1);wp.hooks.applyFilters("wccon-display-compatibility-alerts",s)&&toastr.error(e.text)}}t(".wccon-component-has-children",this.builderWrapper).each(((e,s)=>{let o=!0,i=!1;const n=[];t(".wccon-component",t(s)).each((function(){t(this).find(".wccon-component__selected.compatible").length&&(i=!0,n.push(!0)),t(this).find(".wccon-component__selected.incompatible").length&&(i=!0,o=!1,n.push(!1))}));const c=t(s).attr("data-component-slug"),a=t(".wccon-component-inner",t(s)).first().find(".wccon-component__selected");i&&o?(a.addClass("compatible"),a.find("svg").html('<use xlink:href="#icon-check"></use>')):i&&!o&&(a.addClass("incompatible"),a.find("svg").html('<use xlink:href="#icon-uncheck"></use>')),n.length&&-1!==n.indexOf(!0)?t(`.product-top__required-item[data-image-slug="${c}"]`).addClass("compatible"):n.length&&-1===n.indexOf(!0)&&t(`.product-top__required-item[data-image-slug="${c}"]`).addClass("incompatible")}))}runCompatibilitySaved(){this.compatiblityEnabled&&t(".wccon-component",this.builderWrapper).each((function(e,s){const o=t(s).attr("data-tippy");if(o&&""!==o){const e=t(s).find(".wccon-component__selected");e.length&&tippy(e.get(0),{content:o,popperOptions:{modifiers:[{name:"eventListeners",enabled:!1}]}})}}))}quantityButtonsHandler(t){}editProduct(e){const s=e.currentTarget,o=t(s).closest(".wccon-component-inner");this.handleGetProducts(o)}collapseProducts(e){e.preventDefault(),e.stopPropagation();const s=e.currentTarget,o=t(s).closest(".wccon-component-inner"),i=t(s).closest(".wccon-component");t(o).removeClass("opened"),i.removeClass("opened"),t(document.body).removeClass("wccon-component-opened"),t(o).siblings(".wccon-product-list").remove(),_(i,"off"),!i.hasClass("selected")&&i.attr("data-copy")&&i.remove(),null!==this.productRequest&&(this.productRequest.abort(),this.productRequest=null),this.totalsContainer.show()}buyProduct(e){e.preventDefault();const s=e.currentTarget;this.builderWrapper.trigger("wccon-before-adding-to-cart",[this]),t(s).attr("disabled",!0),t(s).addClass("loading"),t.ajax({url:this.ajaxUrl,type:"POST",data:{action:"wccon_buy_product",data:JSON.stringify(this.dataStore),nonce:this.nonce},beforeSend:()=>{t(document.body).trigger("adding_to_cart")}}).then((e=>{if(e.success&&e.data.fragments){const o="sessionStorage"in window&&null!==window.sessionStorage;if(void 0!==window.wc_cart_fragments_params){const s=wc_cart_fragments_params.cart_hash_key;t.each(e.data.fragments,(function(e,s){t(e).replaceWith(s)})),o&&(sessionStorage.setItem(wc_cart_fragments_params.fragment_name,JSON.stringify(e.data.fragments)),localStorage.setItem(s,e.data.cart_hash),sessionStorage.setItem(s,e.data.cart_hash),e.data.cart_hash&&sessionStorage.setItem("wc_cart_created",(new Date).getTime()))}t(document.body).trigger("wc_fragments_refreshed"),t(document.body).trigger("wccon_buy_list_success",[e.data]),t(s).attr("disabled",!1),t(s).removeClass("loading")}})).catch((e=>{console.log(e),t(document.body).trigger("wccon_buy_list_error"),t(document.body).trigger("wc_fragments_ajax_error")}))}calculateTotals(t=this.dataStore){let e=0;const s=this;for(const o of t)o.hasOwnProperty("products")&&(e=o.products.reduce((function(t,e){let o=0,i=1;return e.hasOwnProperty("price")&&""!==e.price&&(o=s.maybeStringToNumber(e.price),i=s.maybeStringToNumber(e.quantity,!1)),t+o*i}),e)),o.hasOwnProperty("components")&&(e+=this.calculateTotals(o.components));return e}chooseVariation(t){const e=t.data("product_variations"),s=t.find(".stock"),o=this.getChosenAttributes(t),i=o.data,n=this.findMatchingVariations(e,i).shift(),c=t.find(".price"),a=t.find(".wccon-product-sku span"),r=t.find(".stock"),d=t.find(".product-item__image img"),l=wp.hooks.applyFilters("wccon-variation-first-match",!1);if(o.count&&l&&this.updateVariations("firstmatch"),o.count&&o.count===o.chosenCount)if(n)if(o.chosenCount){this.wccon_set_content(c,n.price_html?n.price_html:n.range_html),this.wccon_set_content(a,n.sku?n.sku:WCCON_BUILDER_FRONT.i18n_sku_na),this.wccon_set_content(r,n.stock_html),n.image&&n.image.url&&n.image.url.length>0&&this.wccon_set_variation_attr(d,"src",n.image.url),t.attr("data-variation-id",n.variation_id),t.attr("data-price",n.display_price),n.is_in_stock?(t.find(".product-item__add").attr("disabled",!1),s.removeClass("outofstock").addClass("instock"),s.html(n.stock_html)):(t.find(".product-item__add").attr("disabled",!0),s.removeClass("instock").addClass("outofstock"),s.html(n.nostock_html));t.closest(".wccon-builder-wrapper").find(`.wccon-component-product[data-product-id="${n.variation_id}"]`).length&&t.find(".product-item__add").attr("disabled",!0)}else this.wccon_set_content(c,n.range_price),this.wccon_set_content(a,n.sku?n.sku:WCCON_BUILDER_FRONT.i18n_sku_na),this.wccon_set_content(r,n.stock_html),n.image&&n.image.url&&n.image.url.length>0&&this.wccon_set_variation_attr(d,"src",n.image.url),t.attr("data-variation-id",""),t.attr("data-price",""),t.find(".product-item__add").attr("disabled",!0);else o.chosenCount=0,t.find(".product-item__add").attr("disabled",!0);else o.chosenCount=0,t.find(".product-item__add").attr("disabled",!0);this.updateVariations()}updateVariations(){t(".wccon-product-item",this.builderWrapper).filter(((e,s)=>t(s).attr("data-product_variations"))).each(((e,s)=>{const o=t(s).data("product_variations"),i=this.getChosenAttributes(t(s)).data;t(s).find("select[name^=attribute_]").each(((e,s)=>{const n=t(s).closest(".product-attribute-group__st-select"),c=t(s).data("attribute_name"),a=t.extend(!0,{},i);a[c]="";const r=this.findMatchingVariations(o,a);if(n.length){let e=t(s),o=t(s).data("show_option_none"),i=":gt(0)",n=0,a=t("<select/>"),b=e.val()||"",v=!0;if(!e.data("attribute_html")){var d=e.clone();d.find("option").removeAttr("attached").prop("disabled",!1).prop("selected",!1),e.data("attribute_options",d.find("option"+i).get()),e.data("attribute_html",d.html())}for(var l in a.html(e.data("attribute_html")),r)if(void 0!==r[l]){var p=r[l].attributes;for(var h in p)if(p.hasOwnProperty(h)){var u=p[h],m="";if(h===c)if(r[l].variation_is_active&&(m="enabled"),u){u=t("<div/>").html(u).text();var g=a.find("option");if(g.length)for(var _=0,w=g.length;_<w;_++){var f=t(g[_]);if(u===f.val()){f.addClass("attached "+m);break}}}else a.find("option:gt(0)").addClass("attached "+m)}}n=a.find("option.attached").length,b&&(v=!1,0!==n&&a.find("option.attached.enabled").each((function(){var e=t(this).val();if(b===e)return v=!0,!1}))),n>0&&b&&v&&"no"===o&&(a.find("option:first").remove(),i=""),a.find("option"+i+":not(.attached)").remove(),e.html(a.html()),e.find("option"+i+":not(.enabled)").prop("disabled",!0),b?v?e.val(b):e.val("").trigger("change"):e.val("")}const b=this.findVariationValue(r,c),v=t(s).closest(".product-attribute-group__nice-select"),y=t(s).closest(".product-attribute-group__color"),C=t(s).closest(".product-attribute-group__button");if(v.length){v.find("select option");const e=v.find("select").val(),s=v.find("ul").find("li"),o=v.find(".product-attribute-selected span");s.removeClass("disabled"),s.each(((s,i)=>{const n=t(i).attr("data-value"),c=e===n?"true":"false";t(i).removeClass("disabled"),""!==n&&-1===b.indexOf(n)&&t(i).addClass("disabled"),"true"===c&&o.text(t(i).text())}))}if(y.length){y.find("select option");const e=y.find("select").val(),s=y.find("ul").find("li");s.removeClass("disabled"),s.each(((s,o)=>{const i=t(o).attr("data-value"),n=e===i?"true":"false";t(o).removeClass("disabled"),""!==i&&-1===b.indexOf(i)&&t(o).addClass("disabled"),t(o).attr("aria-checked",n)}))}if(C.length){C.find("select option");const e=C.find("select").val(),s=C.find("ul").find("li");s.removeClass("disabled"),s.each(((s,o)=>{const i=t(o).attr("data-value"),n=e===i?"true":"false";t(o).removeClass("disabled"),""!==i&&-1===b.indexOf(i)&&t(o).addClass("disabled"),t(o).attr("aria-checked",n)}))}}))}))}findVariationValue(t,e,s){const o=[];for(const s in t)if(void 0!==t[s]){const i=t[s].attributes;for(const t in i)if(i.hasOwnProperty(t)){const s=i[t];t===e&&o.push(s)}}return o}resetVariations(e){e.preventDefault();const s=t(e.currentTarget).closest(".wccon-product-item"),o=s.find(".wccon-product-sku span"),i=s.find(".price"),n=s.find(".stock"),c=s.find(".product-item__image img");s.find("select[name^=attribute_]").val("").trigger("change");const a=s.find(".product-attribute-group__nice-select");a.length&&a.each((function(e,s){const o=t(s).find("select[name^=attribute_] option:eq(0)");t(s).find(".product-attribute-selected span").text(o.text())})),this.wccon_reset_content(o),this.wccon_reset_content(i),this.wccon_reset_content(n),this.wccon_reset_variation_attr(c,"src"),n.html().includes("#icon-chk-small")?n.removeClass("outofstock").addClass("instock"):n.removeClass("instock").addClass("outofstock"),s.trigger("reset_data")}findMatchingVariations(t,e){const s=[];for(let o=0;o<t.length;o++){const i=t[o];this.isMatch(i.attributes,e)&&s.push(i)}return s}isMatch(t,e){let s=!0;for(const o in t)if(t.hasOwnProperty(o)){const i=t[o],n=e[o];void 0!==i&&void 0!==n&&0!==i.length&&0!==n.length&&i!==n&&(s=!1)}return s}getChosenAttributes(e){const s={};let o=0,i=0;return e.find("select[name^=attribute_]").each((function(){const e=t(this).data("attribute_name")||t(this).attr("name"),n=t(this).val()||"";n.length>0&&i++,o++,s[e]=n})),{count:o,chosenCount:i,data:s}}addMultiple(t){}handleExpandDescription(e){e.preventDefault(),e.stopPropagation();const s=e.currentTarget;t(s).closest(".wccon-product-title").siblings(".product-item__desc").toggleClass("active"),t(s).toggleClass("active")}maybeGetProducts(e){const s=e.currentTarget,o=t(s).closest(".wccon-component");if(o.hasClass("wccon-component-has-children"))o.toggleClass("subgroup-opened");else if(!o.hasClass("selected")&&(t(s).hasClass("opened")||(this.builderWrapper.find(".wccon-component").not(o).each(((e,s)=>{t(s).removeClass("opened"),t(s).find(".wccon-component-inner").removeClass("opened"),t(s).find(".wccon-product-list").remove()})),null!==this.productRequest&&(this.productRequest.abort(),this.productRequest=null),this.totalsContainer.show()),!t(e.target).closest(".wccon-component-product-item").length))return t(s).hasClass("opened")?(t(s).removeClass("opened"),o.removeClass("opened"),t(s).siblings(".wccon-product-list").remove(),t(document.body).removeClass("wccon-component-opened"),_(o,"off"),!o.hasClass("selected")&&o.attr("data-copy")&&o.remove(),null!==this.productRequest&&(this.productRequest.abort(),this.productRequest=null),void this.totalsContainer.show()):void(o.hasClass("selected")||this.handleGetProducts(s))}handleGetProducts(e){const s=t(e).closest(".wccon-component"),o=s.hasClass("extra");let i="component_id";t(e).siblings(".wccon-component").length&&(i="subgroup_id");const n=s.data("component-id"),c=s.data("component-slug");this.componentId=n,this.componentSlug=c,function(e,s,o=!1){const i=[],n=t(e);if(!n.length)return;const c=t("<div />",{class:"wccon-product-list"}),a=t("<div />",{class:"wccon-skeleton-aside"}),r=[];for(let e=0;e<3;e++){const e=t("<div />",{class:"wccon-skeleton-filter-item"}),s=t("<div/>",{class:"wccon-skeleton-filter-head"}),o=t("<div/>",{class:"wccon-skeleton-filter-list"}),i=[];for(let e=0;e<5;e++){const e=t("<div/>",{class:"wccon-skeleton-filter-list__item"}),s=t("<div/>",{class:"wccon-skeleton-filter-list__check"}),o=t("<div/>",{class:"wccon-skeleton-filter-list__label"});e.append(s),e.append(o),i.push(e)}o.append(i),e.append(s),e.append(o),r.push(e)}a.append(r);const d=t("<div />",{class:"wccon-skeleton-content"}),l=t("<div />",{class:"wccon-skeleton-content-top"}),p=t("<div />",{class:"wccon-skeleton-content-top__one"}),h=t("<div />",{class:"wccon-skeleton-content-top__two"}),u=t("<div />",{class:"wccon-skeleton-content-top__three"});l.append(p),l.append(h),l.append(u);const m=t("<div />",{class:"wccon-skeleton-product-items wccon-scrl-container"});for(let e=0;e<s;e++){const e=t("<div/>",{class:"wccon-skeleton-product-item"}),s=t("<div/>",{class:"wccon-skeleton-product-image"}),o=t("<div/>",{class:"wccon-skeleton-product-body"}),n=t("<div/>",{class:"wccon-skeleton-product-body__one"}),c=t("<div/>",{class:"wccon-skeleton-product-body__two"}),a=t("<div/>",{class:"wccon-skeleton-product-body__three"}),r=t("<div/>",{class:"wccon-skeleton-product-actions"});o.append(n),o.append(c),o.append(a),e.append(s),e.append(o),e.append(r),i.push(e)}m.append(i),d.append(l),d.append(m),c.append(a),c.append(d),o?n.html(c):c.insertAfter(n)}(e,5),t(e).addClass("opened"),s.addClass("opened"),t("html, body").animate({scrollTop:t(e).offset().top},200),t(document.body).addClass("wccon-component-opened"),_(s,"on"),this.builderWrapper.trigger("wccon-component-opened",[c]);const a=u(c,this.productScheme.groups);this.totalsContainer.hide(),null!==this.productRequest&&(this.productRequest.abort(),this.productRequest=null),this.productRequest=t.ajax({url:this.ajaxUrl,type:"POST",data:{action:"wccon_component_products",[i]:n,extra:o,products:a,nonce:this.nonce}}),this.productRequest.then((o=>{if(o.success){t(e).siblings(".wccon-product-list").remove(),t(o.data.html).insertAfter(t(e)),this.builderWrapper.trigger("wccon-products-loaded",[c]),_(s,"off");_(t(e).closest(".wccon-component"),"on")}})).catch((t=>console.log(t)))}saveList(e){e.preventDefault();let s=0;this.isListExists()&&(s=this.getListId());const o=t(e.currentTarget).closest("button");o.attr("disabled",!0),o.addClass("loading"),t.ajax({url:this.ajaxUrl,type:"POST",data:{action:"wccon_save_list",data:JSON.stringify(this.productScheme),id:this.builderId,saved_list_id:s,nonce:this.nonce}}).then((t=>{if(t.success)toastr.success(this.successMessage);else{const e=t.data.message?t.data.message:this.errorMessage;toastr.error(e)}o.attr("disabled",!1),o.removeClass("loading")})).catch((t=>{console.log(t),toastr.error(this.errorMessage)}))}clearList(e){e.preventDefault(),this.productScheme={...this.productScheme,groups:d(this.builderWrapperData.groups)},this.dataStore=this.productScheme.groups,this.maybeSaveToStorage(),this.totalPrice=this.calculateTotals(),this.totalPriceField.html(a(this.totalPrice));const s=t(".wccon-component[data-component-slug]",this.builderWrapper),o=wp.template("wccon-empty-component"),i=wp.template("wccon-empty-subgroup");s.each(((e,s)=>{t(s).attr("data-copy")&&t(s).remove();const n=t(s).find(".wccon-component__body"),c=t(s).hasClass("wccon-component-has-children");t(s).removeClass("selected");const a=t(s).find(".wccon-component__selected");if(a.find("svg").html('<use xlink:href="#icon-check"></use>'),a.removeClass("compatible incompatible"),c){const e=t(s).find(".wccon-component-inner .wccon-component__body").first();e.siblings(".wccon-component__icon").show(),e.replaceWith(i({}))}else{const t={};n.siblings(".wccon-component__icon").show(),n.replaceWith(o(t))}})),this.builderWrapper.trigger("wccon-builder-cleared",[this])}shareList(e){e.preventDefault();const s=t(this).parents(".wccon-product-top__right").find(".wccon-share-box");if(s.toggleClass("active"),window.matchMedia("(max-width: 768px)").matches)t(this).is(".wccon-share-list-button")?t("#wccon-share-modal").fadeIn(400,(function(e){t(this).css("display","flex")})):t("#wccon-share-modal").fadeOut(400,(function(e){t(this).css("display","none")}));else if(t(this).is(".wccon-share-list-button")){const t=s.get(0).scrollHeight;s.hasClass("jcstart")||s.addClass("jcstart"),s.outerHeight(t+10)}else t(this).is(".wccon-share-close")&&s.hasClass("jcstart")&&s.outerHeight(0)}async copyLink(e){e.preventDefault();const s=t(e.currentTarget).attr("href");if(navigator.clipboard)try{await navigator.clipboard.writeText(s),toastr.success(this.copiedMessage)}catch(t){console.error("Failed to copy: ",t)}else{const e=t("<input />",{type:"text"});e.val(s),e.css("position","absolute"),e.css("left","-9999px"),t(document.body).append(e),e.focus(),e.select(),document.execCommand("copy"),e.remove(),toastr.success(this.copiedMessage)}}toggleWidget(){const e=t(this).siblings(".wccon-widget-body");if(t(this).toggleClass("active"),e.toggleClass("active"),e.hasClass("active")){const t=wp.hooks.applyFilters("wccon-widget-body-height","220px");e.css("max-height",t),e.parent().addClass("opened")}else e.css("max-height","0px"),e.parent().removeClass("opened")}openMyListsHandler(e){e.preventDefault(),t("html").css("overflow","hidden");const s=this;t("#wccon-user-list").fadeIn(400,(function(e){t(this).css("display","flex"),t(".wccon-saved-lists",t("#wccon-user-list")).length?h("#wccon-user-list"):(g("#wccon-user-list .wccon-modal__body",6),h("#wccon-user-list"),t.ajax({url:WCCON_BUILDER_FRONT.ajax_url,type:"POST",data:{action:"wccon_user_list",nonce:WCCON_BUILDER_FRONT.nonce,shortcode_id:t(s).closest(".wccon-builder-wrapper").data("wccon-builder")}}).then((e=>{t("#wccon-user-list").find(".wccon-skeleton-item").remove(),t(".wccon-modal__body",t("#wccon-user-list")).html(e.data.html),h("#wccon-user-list")})))}))}openUsersListsHandler(e){e.preventDefault(),t("html").css("overflow","hidden");const s=this;t("#wccon-users-list").fadeIn(400,(function(e){t(this).css("display","flex"),t(".wccon-saved-lists",t("#wccon-users-list")).length?h("#wccon-users-list"):(g("#wccon-users-list .wccon-modal__body",6),h("#wccon-users-list"),t.ajax({url:WCCON_BUILDER_FRONT.ajax_url,type:"POST",data:{action:"wccon_users_list",nonce:WCCON_BUILDER_FRONT.nonce,shortcode_id:t(s).closest(".wccon-builder-wrapper").data("wccon-builder")}}).then((e=>{t("#wccon-users-list").find(".wccon-skeleton-item").remove(),t(".wccon-modal__body",t("#wccon-users-list")).html(e.data.html),h("#wccon-users-list")})))}))}closeModal(e){e.preventDefault(),t("html").css("overflow","initial"),t(this).closest(".wccon-modal").fadeOut(400,(function(e){t(this).css("display","none")}))}openFilters(e){e.preventDefault(),t(".wccon-product-list aside").addClass("opened")}closeFilters(e){e.preventDefault(),t(".wccon-product-list aside").removeClass("opened")}toggleExtraHandler(e){const s=t(e.currentTarget).closest(".wccon-component-extra"),o=t(s).parents(".wccon-group");s.toggleClass("opened"),t(".wccon-component.extra",o).not(".selected").toggleClass("exhide")}expandWidget(){const e=t(this).closest(".wccon-widget-body");e.find(".h-widget").removeClass("h-widget");e.find(".wccon-widget-items").addClass("active"),t(this).hide(),t(this).closest(".widget-expander").addClass("opened"),t(this).siblings(".widget-expander-hide").show()}collapseWidget(){const e=t(this).closest(".wccon-widget-body");e.find("li").each(((e,s)=>{void 0!==t(s).attr("data-hide-widget")&&t(s).addClass("h-widget")}));e.find(".wccon-widget-items").removeClass("active"),t(this).hide(),t(this).closest(".widget-expander").removeClass("opened"),t(this).siblings(".widget-expander-show").show()}maybeStringToNumber(t,e=!0){let s=0;return s=e?parseFloat(t):parseInt(t,10),s=isNaN(s)||!isFinite(s)?0:s,s}maybeSaveToStorage(){if(!this.saveToStorage)return;if(this.isListExists())return;const t=localStorage.getItem("wccon-list"),e=t?JSON.parse(t):[];if(e.find((t=>parseInt(t.id,10)===parseInt(this.builderId,10)))){const t=e.map((t=>{if(parseInt(t.id,10)===parseInt(this.builderId,10)){const e={...t,groups:this.productScheme.groups};return this.currentLang&&(e.lang=this.currentLang),e}return t}));return void localStorage.setItem("wccon-list",JSON.stringify(t))}const s={groups:this.productScheme.groups,id:this.builderId};this.currentLang&&(s.lang=this.currentLang),e.push(s),localStorage.setItem("wccon-list",JSON.stringify(e))}isListExists(){const t=window.location.href;return!!new RegExp(WCCON_BUILDER_FRONT.endpoint_slug+"\\/\\edit\\/\\d+").test(t)||!(!this.savedListQuery||!r(this.savedListQuery))}getListId(){const t=window.location.href,e=new RegExp(WCCON_BUILDER_FRONT.endpoint_slug+"\\/\\edit\\/(\\d+)"),s=t.match(e);return s?parseInt(s[1],10):this.savedListQuery&&r(this.savedListQuery)?r(this.savedListQuery):0}isAccountPage(){const t=window.location.href;return!!new RegExp(WCCON_BUILDER_FRONT.endpoint_slug+"\\/\\edit\\/\\d+").test(t)}wccon_set_content(t,e){void 0===t.attr("data-o_content")&&t.attr("data-o_content",t.html()),t.html(e)}wccon_reset_content(t){void 0!==t.attr("data-o_content")&&t.html(t.attr("data-o_content"))}wccon_set_variation_attr(t,e,s){void 0===t.attr("data-o_"+e)&&t.attr("data-o_"+e,t.attr(e)?t.attr(e):""),!1===s?t.removeAttr(e):t.attr(e,s)}wccon_reset_variation_attr(t,e){void 0!==t.attr("data-o_"+e)&&t.attr(e,t.attr("data-o_"+e))}}t(document).ready((function(){const e=t(".wccon-builder-wrapper").first();e.length&&(new w(e),t(document.body).addClass("wccon-page-builder"))}));new class{constructor(){this.successMessage=WCCON_BUILDER_FRONT.i18n_success_message,this.copiedMessage=WCCON_BUILDER_FRONT.i18n_copied_message,this.successMessageRemove=WCCON_BUILDER_FRONT.i18n_success_message_remove,this.errorMessage=WCCON_BUILDER_FRONT.i18n_error_message,this.addedToCartMessage=WCCON_BUILDER_FRONT.i18n_added_to_cart,this.removeListMessage=WCCON_BUILDER_FRONT.i18n_remove_list,this.endpoint=WCCON_BUILDER_FRONT.endpoint,this.nonce=WCCON_BUILDER_FRONT.nonce,this.removeListButton=t(".wccon-remove-list"),t(document.body).on("click",".wccon-list-button-buy",this.buyProduct).on("click",".wccon-list-button-share",this.toggleShare).on("click",".wccon-close-share",this.toggleShare).on("click",".wccon-saved-list .share-link",this.copyLink.bind(this)).on("wccon_buy_list_success",this.buySuccess.bind(this)).on("wccon_buy_list_error",this.buySuccess.bind(this)).on("click",".wccon-load-more",this.loadMore),this.removeListButton.on("click",this.removeList.bind(this)),window.location.href===this.endpoint&&t(document.body).addClass("wccon-page-builder")}buyProduct(e){e.preventDefault();const s=t(this).data("id");s&&(t(document.body).trigger("wccon-before-adding-to-cart",[s]),t(this).attr("disabled",!0),t(this).addClass("loading"),t.ajax({url:WCCON_BUILDER_FRONT.ajax_url,type:"POST",data:{action:"wccon_buy_list",list_id:s,nonce:WCCON_BUILDER_FRONT.nonce}}).then((e=>{if(e.success&&e.data.fragments){const s="sessionStorage"in window&&null!==window.sessionStorage;if(void 0!==window.wc_cart_fragments_params){const o=wc_cart_fragments_params.cart_hash_key;t.each(e.data.fragments,(function(e,s){t(e).replaceWith(s)})),s&&(sessionStorage.setItem(wc_cart_fragments_params.fragment_name,JSON.stringify(e.data.fragments)),localStorage.setItem(o,e.data.cart_hash),sessionStorage.setItem(o,e.data.cart_hash),e.data.cart_hash&&sessionStorage.setItem("wc_cart_created",(new Date).getTime()))}t(document.body).trigger("wc_fragments_refreshed"),t(document.body).trigger("wccon_buy_list_success",[e.data]),t(this).attr("disabled",!1),t(this).removeClass("loading")}})).catch((e=>{console.log(e),t(document.body).trigger("wccon_buy_list_error"),t(document.body).trigger("wc_fragments_ajax_error")})))}buySuccess(e,s){toastr.success(this.addedToCartMessage),setTimeout((()=>{t("html").css("overflow","initial"),t(".wccon-modal").fadeOut()}),800)}buyError(t,e){toastr.error(this.errorMessage)}toggleShare(){t(this).closest(".wccon-saved-list").find(".saved-lists__share-box").toggleClass("active")}async copyLink(e){e.preventDefault();const s=t(e.currentTarget).attr("href");if(navigator.clipboard)try{await navigator.clipboard.writeText(s),toastr.success(this.copiedMessage)}catch(t){console.error("Failed to copy: ",t)}else{const e=t("<input />",{type:"text"});e.val(s),e.css("position","absolute"),e.css("left","-9999px"),t(document.body).append(e),e.focus(),e.select(),document.execCommand("copy"),e.remove(),toastr.success(this.copiedMessage)}}loadMore(e){e.preventDefault();const s=t(this).attr("data-current"),o=t(this).attr("data-total"),i=t(".wccon-builder-wrapper").first().data("wccon-builder");if(r(o)<=r(s))return;const n=t(this).closest(".wccon-modal"),c=t(this).data("type");t(this).addClass("loading"),t(this).attr("disabled",!0),"user"===c?(g("#wccon-user-list .wccon-saved-lists",6,!0,!0),h(n)):(g("#wccon-users-list .wccon-saved-lists",6,!0,!0),h(n)),t.ajax({url:WCCON_BUILDER_FRONT.ajax_url,type:"POST",data:{action:"wccon_load_more",nonce:WCCON_BUILDER_FRONT.nonce,listType:c,currentPage:s,shortcode_id:i}}).then((e=>{if(e.success){n.find(".wccon-skeleton-item").remove();const i=t.parseHTML(e.data.html);let c=!0;t(i[0]).find(".wccon-saved-list").each((function(e,s){c=!1,t(".wccon-saved-lists",n).append(t(s))})),h(n),t(this).removeClass("loading"),t(this).attr("disabled",!1),t(this).attr("data-current",r(s)+1),r(o)<=r(s)+1&&t(this).hide()}})).catch((t=>{console.log(t)}))}removeList(e){e.preventDefault();const s=t(e.currentTarget).closest("button").data("id");wp.hooks.applyFilters("wccon-remove-list",(()=>{window.confirm(this.removeListMessage)&&t.ajax({url:WCCON_BUILDER_FRONT.ajax_url,type:"POST",data:{action:"wccon_remove_list",listId:s,nonce:WCCON_BUILDER_FRONT.nonce}}).then((e=>{e.success&&e.data.deleted?(toastr.success(this.successMessageRemove),t(`.wccon-saved-list[data-id="${e.data.list_id}"]`).remove()):toastr.error(this.errorMessage)})).catch((t=>{console.log(t)}))}),s,this)()}},t(window).resize((function(){!function(){const s=window.innerHeight;t(".wccon-product-list .aside").css({height:s-70+"px","max-height":"none"});const o=t(".wccon-modal");o.length&&(s<660||window.innerWidth,o.each(((o,i)=>{const n=t(i).find(".wccon-saved-lists"),c=t(i).find(".wccon-modal-inner"),a=t(i).find(".wccon-modal__header"),r=t(i).find(".wccon-button-container"),d=(c.outerHeight(),a.outerHeight());let l=r.outerHeight();l||(l=50);let p=150;e&&(p=50);const h=s-d-l-p;n.height(h)})))}()}))}(jQuery);